# Querying Multiple Tables

!!! info
    Database, table dan records yang digunakan pada sesi ini anda dapat merujuk ke [resource](index.md#mana-resource-nya). Dan untuk menjamin kelancaran penggunaan setiap query yang ada pada catatan ini, maka saya sarankan untuk menggunakan schema `lahmansbaseballdb`, jika belum ada buat schema dengan nama tersebut.

!!! warning
    Jika query dibawah ini tidak mensiratkan penggunaan nama schema maka saya menggunakan `#!sql USE lahmansbaseballdb;` pada session saya. Anda dapat mengikuti cara tersebut atau selalu siratkan nama scema anda jika menggunakan nama selain lahmansbaseballdb.

    ``` sql title="Contoh menyiratkan nama schema"
        SELECT * 
        FROM nama_data_base.contoh_table;
    ```

## Understanding JOIN
JOIN adalah proses menghubungkan dua atau lebih tabel dalam satu query tunggal. Menggabungkan tabel-tabel dalam sebuah query mewajibkan anda untuk menggabungkan mereka pada kolom yang berhubungan atau memiliki relasi pada setiap tabel yang ingin digabungkan. Ada beberapa pasanga tipe join, diantaranya.

* **Inner Join** : Tipe ini, mengembalikan hanya record yang sesuai dari setiap table yang digabungkan.
   
* **Outer Join** : Tipe ini  memeliki beberapa join yang dapat digunakan, sebegai berikut;
    * _Left Outer Join_ : Tipe join ini mengembalikan semua baris dari tabel kiri serta baris yang cocok antara tabel kiri dan kanan.
      
    * _Right Outer Join_ : Tipe join ini mengembalikan semua baris dari tabel kanan dan baris yang cocok antara kanan dan kiri.
      
    * _Full Outer Join_ : Tipe join ini mengembalikan semua baris dari kiri dan kanan, tapi tipe ini tidak tersedia di MySql.
      
* **Cross Join** : Tipe join ini mengembalikan sebuah kombinasi setiap baris dari dua tabel, meshhupp form me lol.
   
* **Natural Join** : Tipe dari join ini akan mengaitkan kolom-kolom dengan nama yang sama pada satu sama lain table-table yang di-join. Ini sama dengan inner join atau left outer join, namun tidak harus memperjelas kolom-kolom yang digabung.
   
* **Self Join** : Tipe join ini digunakan untuk mengabungkan sebuah tabel itu sendiri.

### Understanding results returned with an inner join
Venn diagram dibawah ini menggambarkan record-record yang dikembalikan jikn menggabungkan table A dan B menggunakan tipe inner join.

![Inner Join Diagram](aset/6.1%20inner_join_diagram.png)

Diagram diatas menggambarkan hanya nilai yang cocok diantara kedua gabungan tabel tersebut yang dikembalikan oleh tipe inner join.

### Understanding results returned with a left outer join
Left outer join mengembalikan tabel kiri dan baris yang cocok dengan table kiri dan table kanan.

![Inner Join Diagram](aset/6.2%20left_outer_join_diagram.png)

Jika tidak ada baris pada table B yang cocok dengan baris pada table A, maka tipe ini hanya mengembalikan record pada table A. Jika tidak ada dan baris yang dikembalikan pada table A yang tidak memliki kecocokan dengan baris pada tabel B akan menampilkan nilai null untuk kolom pada tabel B.

Selain itu, anda dapat menggunakan left excluding join. Dengan ini, tipe ini akan mengembalikan semua baris pada tabel kiri namun tidak termasuk baris yang cocok dengan tabel kanan. Penggambaran ini ada pada gambar dibawah.

![Inner Exclude Join Diagram](aset/6.3%20left_excluding_join_diagram.png)

### Understanding results returned with a right outer join
Right outer join mengembalikan tabel kanan  dan baris yang cocok antara tabel kanan dan tabel kiri.

![Right Outer Join Diagram](aset/6.4%20right_outer_join_diagram.png)

Jika tidak baris pada tabel A yang cocok dengan baris pada table B maka tipe join ini akan mengembalikan baris pada table B saja. Dan baris pada tabel B yang tidak ada baris yang cocok dengan tabel akan akan menampilkan nilai null pada kolom di table B.

Sama denga left outer join, tipe ini juga memliki right excluding join.
![Right Exclude Join Diagram](aset/6.5%20right_exclude_join_diagram.png)


## Using Inner JOIN
Jika anda bermaksud menampilkan baris yang hanya cocok diantara tabel maka gunakanlah INNER JOIN.

### Learning INNER JOIN syntax
Untuk menggabungkan tabel menggunakan `#!sql INNER JOIN` gunakan syntax dibawah ini (standar using of inner join)

```{.sql .no-copy tittle="Syntax Select dengan Inner Join"}
SELECT column(s)
FROM table_1
INNER JOIN table_2
ON table_1.column = table_2.column
WHERE conditions
ORDER BY column(s)
```
 
Query diatas hanya akan mengembalikan baris yang cocok antara table_1 dan table_2.

Oke, mudahnya, kita akan gunakan langsung pada database `lahmansbaseballdb` untuk men-join tabel-tabel didalamnya. Misalkan, kita ingin men-join tabel dari **appearances** dan **people**.

``` sql
SELECT people.nameFirst, people.nameLast, appearances.playerID, appearances.G_all
FROM appearances
INNER JOIN people
ON appearances.playerID = people.playerID;
```

??? quote "Output Query dan Explain"
    ``` {.sql .no-copy title="Output Query"}
    +--------------+----------------+-----------+-------+
    | nameFirst    | nameLast       | playerID  | G_all |
    +--------------+----------------+-----------+-------+
    | David        | Aardsma        | aardsda01 |     1 |
    | David        | Aardsma        | aardsda01 |    11 |
    | David        | Aardsma        | aardsda01 |    25 |
    | David        | Aardsma        | aardsda01 |    33 |
    | David        | Aardsma        | aardsda01 |    43 |
    | ................................................. |
    ```

    ``` {.sql .no-copy title="Explain"}
    +----+-------------+-------------+------------+------+--------------------+--------------------+---------+-----------------------------------+-------+----------+--------------------------+
    | id | select_type | table       | partitions | type | possible_keys      | key                | key_len | ref                               | rows  | filtered | Extra                    |
    +----+-------------+-------------+------------+------+--------------------+--------------------+---------+-----------------------------------+-------+----------+--------------------------+
    |  1 | SIMPLE      | people      | NULL       | ALL  | NULL               | NULL               | NULL    | NULL                              | 19554 |   100.00 | Using where              |
    |  1 | SIMPLE      | appearances | NULL       | ref  | NC_playerid_g_cols | NC_playerid_g_cols | 38      | lahmansbaseballdb.people.playerID |     5 |   100.00 | Using where; Using index |
    +----+-------------+-------------+------------+------+--------------------+--------------------+---------+-----------------------------------+-------+----------+--------------------------+
    2 rows in set, 1 warning (0.00 sec)
    ```

Tidak sebatas dua table, ==join tabel dapat kita lakukan pada lebih dari dua tabel==. Kasus ini kita ingin meng-query tiga table, appearances, people dan batting.

```sql
SELECT people.playerID, people.birthYear, appearances.yearID, appearances.teamID, appearances.G_defense, batting.H
FROM appearances
INNER JOIN people
ON appearances.playerID = people.playerID
INNER JOIN batting
ON people.playerID = batting.playerID
WHERE batting.yearid = 2017 AND H <> 0
ORDER BY people.playerID, appearances.yearID, appearances.teamID, appearances.G_defense, batting.H;
```

??? quote "Output"
    ``` {.sql .no-copy"}
    +-----------+-----------+--------+--------+-----------+------+
    | playerID  | birthYear | yearID | teamID | G_defense | H    |
    +-----------+-----------+--------+--------+-----------+------+
    | abreujo02 |      1987 |   2014 | CHA    |       109 |  189 |
    | abreujo02 |      1987 |   2015 | CHA    |       115 |  189 |
    | abreujo02 |      1987 |   2016 | CHA    |       152 |  189 |
    | abreujo02 |      1987 |   2017 | CHA    |       139 |  189 |
    | abreujo02 |      1987 |   2018 | CHA    |       114 |  189 |
    | adamsla01 |      1989 |   2014 | KCA    |         2 |   30 |
    | adamsla01 |      1989 |   2017 | ATL    |        41 |   30 |
    | .......................................................... |
    ```

Diagram dibawah ini menggambarkan baris yang dikembalikan atas query diatas
![Grafik Output Query Join 3 tabel](aset/6.6%20diagram_3_join_table.png)


### Learning how to use table aliases
Fitur aliases membuat kita dapat memberikan nama pendek pada nama kolom didalam query. Manfaatnya penulisan nama kolom atau table menjadi lebih singkat dengan dibuatnya alias ini. Berikut adalah penggunakan aliases menggunakan keyword `#!sql AS` pada query join 3 tabel.

``` sql
SELECT B.playerID, B.birthYear, A.yearID, A.teamID, A.G_defense, C.H
FROM appearances AS A
INNER JOIN people AS B
ON A.playerID = B.playerID
INNER JOIN batting AS C
ON B.playerID = C.playerID
WHERE C.yearid = 2017 AND H <> 0
ORDER BY B.playerID, A.yearID, A.teamID, A.G_defense, C.H;
```

## Using OUTER JOIN
### Lerning LEFT OUTER JOIN syntax
Untuk menggunakan tipe join ini gunakan syntax berikut
``` sql
SELECT column(s)
FROM table_1
INNER JOIN table_2
ON table_1.column = table_2.column
WHERE conditions
ORDER BY column(s)
```

Query diatas akan mengembalikan seluruh baris pada tabel_1 dan baris pada tabel_2 yang cocok dengan table_1

Hmm oke kita coba langsung penerapannya. Anda diminta untuk menampilkan pemain dengan kelahiran 1985, serta beberapa informasi tentang pemain tersebut ketika bermain di sekolah mereka. 

```sql
SELECT p.playerID, p.nameGiven, p.birthYear, c.schoolID, c.yearID
FROM people p
LEFT OUTER JOIN collegeplaying c
ON p.playerID = c.playerID
WHERE p.birthYear = 1985;
```

??? quote "Output"
    ``` {.sql .no-copy}
    +-----------+-----------------------+-----------+------------+--------+
    | playerID  | nameGiven             | birthYear | schoolID   | yearID |
    +-----------+-----------------------+-----------+------------+--------+
    | abadfe01  | Fernando Antonio      |      1985 | NULL       |   NULL |
    | abreuju01 | Juan de Dios          |      1985 | NULL       |   NULL |
    | adducji02 | Jim Charles           |      1985 | NULL       |   NULL |
    | alberan01 | Andrew William        |      1985 | kentucky   |   2005 |
    | alberan01 | Andrew William        |      1985 | kentucky   |   2006 |
    | alberan01 | Andrew William        |      1985 | kentucky   |   2007 |
    ```

Sebagaiman yang kita lihat diatas, ada beberapa baris yang menampilkan nilai NULL, artinya, playerID pada tabel collageplaying tidak ada yang cocok dengan playerid pada tabel people.

Sama dengna inner join, outer join juga dapat menggabungkan lebih dari dua buah tabel. Dari query terakhir diaras mari kita tambah dengan menampilkan kolom yearid dan gameid pada tabel allstarfull.

```sql
SELECT p.playerID, p.nameGiven, p.birthYear, c.schoolID, c.yearID
FROM people AS p
LEFT OUTER JOIN collegeplaying AS c
ON p.playerID = c.playerID
LEFT OUTER JOIN allstarfull AS asf
ON c.playerID = asf.playerID
WHERE p.birthYear = 1985;
```

??? quote "Output"
    ```{.sql .no-copy}
    +-----------+-----------------------+-----------+------------+--------+
    | playerID  | nameGiven             | birthYear | schoolID   | yearID |
    +-----------+-----------------------+-----------+------------+--------+
    | abadfe01  | Fernando Antonio      |      1985 | NULL       |   NULL |
    | abreuju01 | Juan de Dios          |      1985 | NULL       |   NULL |
    | adducji02 | Jim Charles           |      1985 | NULL       |   NULL |
    | alberan01 | Andrew William        |      1985 | kentucky   |   2005 |
    | alberan01 | Andrew William        |      1985 | kentucky   |   2006 |
    | alberan01 | Andrew William        |      1985 | kentucky   |   2007 |
    ```

Selain itu, anda bisa menggunakan excluding join, jadi, query tersebut akan mengembalikan semua baris yang tidak ada kecocokan dengan baris pada bagian kanannya, nilai pengembaliannya akan seperti ini

![Left Excluding Join](aset/6.3%20left_excluding_join_diagram.png)

Untuk excluding join anda dapat menggunakan syntax dibawah ini
```sql
SELECT column(s)
FROM table_1
LEFT OUTER JOIN table_2
ON table_1.column = table_2.column
WHERE table2.column IS NULL;
```

Yup, kita hanya menambah kondisi dimana pada kolom pada table_2 bernilai Null. Ingat, setiap baris pada table yang ke-2 akan bernilai null jika tidak ada baris yang cocok dengan tabel utama.

Sekarang mari kita excluding join pada query outer join 3 tabel terakhir kita
```sql
SELECT p.playerID, p.nameGiven, p.birthYear, c.schoolID, c.yearID
FROM people AS p
LEFT OUTER JOIN collegeplaying AS c
ON p.playerID = c.playerID
LEFT OUTER JOIN allstarfull AS asf
ON c.playerID = asf.playerID
WHERE p.birthYear = 1985 AND asf.playerID IS NULL AND c.playerID IS NULL;
```

??? quote "Output"
    ```{.sql .no-copy}
    +-----------+-----------------------+-----------+----------+--------+
    | playerID  | nameGiven             | birthYear | schoolID | yearID |
    +-----------+-----------------------+-----------+----------+--------+
    | abadfe01  | Fernando Antonio      |      1985 | NULL     |   NULL |
    | abreuju01 | Juan de Dios          |      1985 | NULL     |   NULL |
    | adducji02 | Jim Charles           |      1985 | NULL     |   NULL |
    | ascanjo01 | Jose Eleazar          |      1985 | NULL     |   NULL |
    | atilalu01 | Luis A.               |      1985 | NULL     |   NULL |
    ```

## Learning RIGHT OUTER JOIN syntax
Untuk menggunakan tipe join ini gunakan syntax berikut
```{.sql .no-copy}
SELECT column(s)
FROM table_1
RIGHT OUTER JOIN table_2
ON table_1.column = table_2.column
WHERE conditions
ORDER BY column(s)
```

Query diatas akan mengambil semua baris pada table 2 dan baris pada tabel 1 yang cocok dengan baris pada table 2.

Mari kita buat query untuk melihat hasil dari RIGHT OUTER JOIN
```sql
SELECT p.playerid, asf.yearid, asf.gameid, asf.startingpos
FROM lahmansbaseballdb.allstarfull asf
RIGHT OUTER JOIN lahmansbaseballdb.people p
ON p.playerid = asf.playerid;
```

??? quote "Output"
    ```{.sql .no-copy}
    +-----------+--------+--------------+-------------+
    | playerid  | yearid | gameid       | startingpos |
    +-----------+--------+--------------+-------------+
    | aardsda01 |   NULL | NULL         |        NULL |
    | aaronha01 |   1955 | NLS195507120 |        NULL |
    | aaronha01 |   1956 | ALS195607100 |        NULL |
    | aaronha01 |   1957 | NLS195707090 |           9 |
    | aaronha01 |   1958 | ALS195807080 |           9 |
    | aaronha01 |   1959 | NLS195907070 |           9 |
    ```

Ya, query diatas mengambil seluruh baris pada tabel people dan baris yang cocok pada tabel allstarfull dengan baris pada table people.

Sama hal-nya dengan LEFT OUTER JOIN, RIGHT OUTER JOIN dapat menggabungkan lebih dari dua table dan exlcude join menggunalan kalusa WHERE dan IS NULL.

